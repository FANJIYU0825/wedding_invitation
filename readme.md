# SchoolsWeb

##Instalation

### node

Have node v10.x installed.
https://nodejs.org/en/

Tip: nvm is a excellent way to manage installed node versions.

### aws-cli and config

Getting curriculum files and deployment scripts use aws-cli.
awscli is distributed via pip, to install aws cli:  

`pip install awscli --upgrade --user`

*Note: If pip is not installed there are other methods to install aws-cli, see the AWS documentation on installing aws-cli*

Once installed, the following should be in you aws configuration files:

`~/.aws/config`   

```
[profile dev]
output = json
region = ap-southeast-1

[profile prod]
output = json
region = us-west-2
```

`~/.aws/credentials`  

```
[dev]
aws_access_key_id = <get from someone with access>
aws_secret_access_key = <get from someone with access>

[prod]
aws_access_key_id = <get from someone with access>
aws_secret_access_key = <get from someone with access>
```

### angular-cli

Install angular-cli globally after which you have the ng command  


`npm install -g @angular/cli@7`

For more info:   
https://github.com/angular/angular-cli


### Clone LMS Repo and install node_modules

Clone the webapp's repository:  
`git clone git@bitbucket.org:studycat/lms.git lms`

Then install node dependencies:

`npm install `

You will also need to install the packages in the `backend/aws` folder.

```
  cd backend/aws
  npm install
```


## Development server

Some assets (teachers guides) will be loaded from S3.
when running locally it will fail because of CORS.
Add the following to you hosts file (/etc/hosts):

```
127.0.0.1   local.study.cat
```

Run `ng serve -c=local` for a local dev server. 
Navigate to `http://local.study.cat:4200/`. 
The app will automatically reload if you change any of the source files.  

## Curriculum files

The curriculum files are generated by an external tool but they are compiled into
LMS. Before building LMS, update the curriculum files as follows:

```
npm run pull-N
npm run pull-P
npm run pull-K
```


## Build

Run `ng build -c=development` to build the project. The build artifacts will be stored in the `dist/` directory.

For Development:  
`ng build -c=development`

For Production:  
`ng build -c=production`

See angular.json for more configurations.



## Running end-to-end tests

*Note* The tests are quite out of date and don't work anymore.
They were hard to maintain and have not kept up with the pace 
of change in LMS. They need a refresh.

Execute the end-to-end tests via [Protractor](http://www.protractortest.org/).
This is very useful and checks that everything still works from the **USERS** perspective.

For Development:  
`ng e2e`

## Deployment


build:
ng build -c=development

upload:
npm run sync-dev

See package.json for other scripts.



